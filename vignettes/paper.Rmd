---
title: "Explore and Evaluate the Mechanisms for Missing Data in the Enhanced Tuberculosis Surveillance System"
author: "Sam Abbott, Hannah Christensen, Ellen Brooks-Pollock"
output: 
      html_document:
      word_document:
        reference_docx: resources/style.docx
vignette: >
  %\VignetteIndexEntry{Explore and Evaluate the Mechanisms for Missing Data in the Enhanced Tuberculosis Surveillance System}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
always_allow_html: true
bibliography: resources/library.bib  
csl: resources/bmj.csl
---


```{r setup, include=FALSE}
## Run code that requires raw data - see data availability for details of how to access the data.
regen_results <- TRUE

## Make folders for data and fig storage and return as a path
data_path <- ETSMissing::make_results_folder("paper/data")
fig_path <- ETSMissing::make_results_folder("paper/figs")


knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, cache = FALSE,
  cache.path = paste0("cache/", "paper" ,"/"),
  fig.width = 8, 
  fig.height = 6, 
  eval = TRUE
  )
```


```{r packages, include = FALSE}
library(here)
library(tidyverse)
library(pander)
library(knitr)
library(kableExtra)
library(broom)
library(prettypublisher)
library(ETSMissing)
```


```{r utility, include = FALSE}
## Set conveniance function paths using {purrr}
save_data <- purrr::partial(ETSMissing::save_data, path = data_path)
save_figure <- purrr::partial(ETSMissing::save_data, path = fig_path)
read_data <- purrr::partial(ETSMissing::save_data, path = data_path)
show_figure <- purrr::partial(ETSMissing::save_data, path = fig_path)
## Set theme
PaperTheme <- theme_minimal() +
  theme(legend.position = "top", text = element_text(size = 12))

ggplot2::theme_set(PaperTheme)
```

**Authors:**

Sam Abbott, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol, UK

Hannah Christensen, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol, UK

Ellen Brooks-Pollock, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol, UK

**Correspondence to:** Sam Abbott, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol BS8 2BN, UK; sam.abbott@bristol.ac.uk; 01173310185

**Words:** *Title:*  *Abstract:*  *Paper:*

# Abstract

## Objectives

## Design


## Setting 


## Outcome measures

## Results *Copy from bottom*

## Conclusions

# Strengths and limitations of this study


# Introduction

Although the characteristics of tuberculosis (TB) in England have been reported elsewhere,[@PHE2017; @PHE2018] and key risk factors such as non-UK birth status have been identified,[@French2007] little attention has been given to the role of BCG vaccination. In particular, there is little information available regarding the demographics of vaccinated versus unvaccinated cases and the impact of BCG vaccination on TB outcomes in England has not been explored. There has also only been limited reporting of the age distribution, and trends over time, in incidence rates stratified by UK birth status.

In this chapter I explore the epidemiology of TB in England using routine datasets with a particular focus on the impact of missing data, the mechanisms underlying that missing data, seasonal trends, the role of age, UK birth status and BCG status. I also estimate incidence rates, stratified by UK birth status and age, which I use to identify trends in TB incidence over time. Finally I report TB outcomes in England using case rates, again stratified by BCG status and UK birth status.

# Methods

## Data sources

### Enhanced tuberculosis surveillance (ETS) system

```{r load-ets, messages = FALSE}
## Load in and clean the ETS extract
## Data cleaning + munging is packaged seperately
## See here: 
if (regen_results) {
  ets <- ETSMissing::read_data("clean_ets_2016", path = here("data-raw/tb_data/tbinenglanddataclean"))
}
```

The ETS is a database that collects demographic, clinical, and microbiological data on all notified TB cases in England and is maintained by Public Health England (PHE). Notification is required by law, with health service providers having to inform PHE of all confirmed TB cases.[@PHE2017] Data collection began in 2000 and was expanded, with additional variables, with the launch of a web based system in 2008.[@Kriujshaar2007] It is updated annually with de-notifications, late notifications and other updates. A descriptive analysis of TB epidemiology in England is published each year, which reports on data collection, cleaning, and trends in TB incidence at both a national, and sub-national level.[@PHE2017]

#### Data extraction and management

Data on all notifications (114,820 notifications) from the ETS system from 2000 to 2015 were obtained from PHE via an application to the TB monitoring team. Data fields included: notification date, age, PHE centre, occupation, ethnic group, UK birth status, years since entry to the UK, date of symptom onset, date of presentation, date of diagnosis, date of treatment start, date of treatment end, date of death, Pulmonary TB status, culture status, sputum smear status, drug resistance, BCG vaccination status, year of vaccination, outcome at 12 months, overall outcome, and cause of death. Notifications were assessed for identifiability and the data release was conditional on the raw data not being shared further. Invalid entries were replaced with missing values unless otherwise noted, with character variables stored as factors using their most common entry as the baseline. Notifications from Scotland, Northern Ireland and Wales were dropped from the dataset. Several variables were created, or modified, for use in further analysis, `r pretty_tabref("created_var")`summarises these variables. The code used for data cleaning is available as an R package^[Data cleaning code: https://www.samabbott.co.uk/tbinenglanddataclean/reference/clean_munge_ets_2016.html].

```{r created-var}
created_var <- tibble(
  `Created/modified variable` = c('Years since BCG', 
                                  'Age at BCG', 
                                  'Successful treatment',
                                  'Mortality', 
                                  'TB mortality',
                                  'Death due to TB'),
  Description = c('Derived using year of vaccination and year of notification. Categorised into $\\leq 10$ and 11+ due to the evidence of waning protection for the BCG vaccine.[@Abubakar2013]', 
                  'Derived using year of vaccination and age at vaccination. Categorised into < 1, 1 to x < 12, 12 to x < 16 and $\\leq 16$ to capture historic vaccination policy.[@PublicHealthEngland2011a]', 
                  'For cases that had a recorded date of starting treatment, with their outcome recorded at the latest available follow up. Those that completed treatment are defined as successfully treated: treatment failure is defined as those that stopped treatment, were lost to follow up, those that died during follow up from TB, those that died during follow up were TB contributed to their death, and those who were still on treatment. Those that were not evaluated were treated as missing.', 
                  'Assessed via follow up at 12 and 24 months: mortality is defined as cases with an overall outcome of death, and survival is defined as those that completed treatment, were still on treatment, and stopped treatment. Those that were lost to follow up, or not evaluated were treated as missing', 
                  'For cases with an overall outcome of died, and whose cause of death was known to be TB or to be related to TB. Those that were known to have not died, or who were known to have died from a cause other than from TB were defined to have not died from TB.',
                  'Death due to TB is defined as those that died directly from TB, or where TB had contributed to their death with death not due to TB being cases that died from any other cause. Conditioned on all-cause mortality, for cases with a known cause of death.')
  
)

pander::pander(created_var, caption = pretty_tabref("created_var","Variables derived or modified from the ETS system for use in the analyses throughout this thesis."), booktabs = TRUE, justify = 'left', split.cells = 50)
```


#### Structure of the ETS

The ETS is in a wide format with each notification having a single row, and with each unique variable having a single column. This structure means that the progression of TB in each individual is captured by a series of dates rather than as a series of events. As notifications are not linked to a unique patient I.D it is possible that individuals are duplicated within the ETS, with multiple notifications. These recurrent notifications have been flagged within the data extract by the TB section at PHE. The majority of variables are factors, with a significant minority of numeric and date variables. 

#### Data completeness

```{r miss-dat-munge, include = FALSE}
## See package docs (?ETSMissing::function) for further implementation details 
if (regen_results) {
  # Account for nested data -------------------------------------------------
  nest_filt_ets <- ets %>%
    ETSMissing::account_for_nested_missing()
  
  # Plot nested missing data ------------------------------------------------
  missing_strut <- nest_filt_ets %>%
    ETSMissing::plot_nested_missing()
  
  save_figure(missing_strut, "plot-missing-struct")
  
  # Estimate missing ness pre and post 2009 ---------------------------------
  miss_ets_pre_2009 <- nest_filt_ets %>%
    dplyr::filter(year < 2009) %>%
    ETSMissing::nested_missing_table()
  
  miss_ets_post_2008 <- nest_filt_ets %>%
    dplyr::filter(year > 2008) %>%
    ETSMissing::nested_missing_table()
  
  save_data(miss_ets_pre_2009, "miss_ets_pre_2009")
  save_data(miss_ets_post_2008, "miss_ets_post_2008")
  
  # Summary stats -----------------------------------------------------------
  ## For nested variables an alternative measure of missing data is to consider the number of missing data
  ## points when top level outcome is known
  missing_stats <- ETSMissing::summarise_missingness(ets)
  
  save_data(missing_stats, "missing_stats")

}else{
  miss_ets_pre_2009 <- read_data(name = "miss_ets_pre_2009")
  miss_ets_post_2008  <- read_data("miss_ets_post_2008")
  missing_stats <- read_data("missing_stats")
}
```

Missing data can take several forms, data that are missing completely at random (MCAR), data that are missing at random (MAR) and data that are missing not at random (MNAR).[@Sterne2009a] Data that are MAR are missing with a mechanism that is conditional on observed variables, whilst MNAR are missing with a mechanism that is conditional on variables that are not observed. Data that is MAR, and MNAR may lead to biases when analysing the data, however it is not possible to deduce from the observed data what the mechanism driving missing data is. Therefore, it is necessary to account for these potential biases during the analysis stage. This is possible using a variety of methods such as scenario analysis accounting for the 'best' and 'worst' case scenarios, and multiple imputation of missing data using additional variables in the dataset to inform the imputation model.[@Sterne2009a]

As the ETS is aggregated across England, from a variety of sources, some level of missing data are inevitable. This takes two forms: under-reporting of notified cases, of which there is some evidence in the literature,[@Pillaye2003] and data missing for a notified case. The former is particularly problematic as apart from using comparative studies the characteristics of those that are not notified is unknown. For variables that are missing data within the dataset it is possible to calculate the proportion of missing data (`r pretty_figref("plot-missing-struct")`, `r pretty_tabref("missing-var-tabs")`) but care must be taken to account for nested variables such as date of death and year of BCG vaccination. This can be done by assuming that the nested variables takes the value of the top level variable when it is known that the variable is not truly missing. An example of this is using overall outcome for date of death when notifications are known to have not died.  Doing this shows high completeness for common demographic variables such as sex, age, ethnic group and UK birth status. More problematically, BCG status and year of BCG status have a high percentage missing, even after accounting for the introduction of national collection of these variables in 2008. Socio-economic status (as national quintiles) was not collected until 2010 but after this point is highly complete.  Comparing pre 2009 and post 2008 in `r pretty_tabref("missing-var-tabs")` (and by inspecting `r pretty_figref("plot-missing-struct")`) there are also issues of changing completeness over time,[@PHE2016; @PHE2017] if this is not accounted for than it may lead to spurious trends. `r pretty_figref("plot-missing-struct")` also indicates that there are multiple groups of variables that share a common pattern of missing data.

```{r plot-missing-struct, fig.cap = pretty_figref("plot-missing-struct", "Summary plot of missing data in the extract of the ETS data used in this thesis. Due to the large size of the dataset, the data has been sub-sampled with only 20\\% of the data shown in this figure. Notifications have been ordered by date of notification from left to right. The following subset of variables are shown: year (year), sex (sex), age (age), PHE Centre (phec), Occupation (occat), Ethnic group (ethgrp), UK birth status (ukborn), Time since entry (timesinceent), date of symptom onset (symptonset), date of diagnosis (datediag), started treatment (startedtreat), date of starting treatment (starttreatdate), treatment end date (txenddate), pulmonary or extra-pulmonary TB (pulmextrapulm), culture (culture), sputum smear status (sputsmear), drug resistance (anyres), previous diagnosis (prevdiag), BCG status(bcgvacc), Year of BCG vaccination (bcgvaccyr), overall outcome (overalloutcome), cause of death (tomdeathrelate), socio-economic status quintiles (natquintile), and date of death (dateofdeath). Nested variables have been accounted for (i.e date of death has had an entry added for cases that are known to have not died), so that true missingness for all variables is estimated."), out.width = "60%", out.extra = ""}
show_figure("plot-missing-struct")
```


```{r missing-var-tabs}
miss_ets <- miss_ets_pre_2009 %>% 
  left_join(miss_ets_post_2008, by = "Variable")

colnames(miss_ets) <- c("Variable", 
                        rep(c("Missing (N)"," Missing (%)"), 2))
  
kable(miss_ets,
      caption = pretty_tabref("missing-var-tabs", "Breakdown of missing data from the ETS prior to the web based system (pre 2009) and post (post 2008) by variable, ordered by the  percentage missing for a subset of variables. The following subset of variables are shown year (year), sex (sex), age (age), PHE Centre (phec), Occupation (occat), Ethnic group (ethgrp), UK birth status (ukborn), Time since entry (timesinceent), date of symptom onset (symptonset), date of diagnosis (datediag), started treatment (startedtreat), date of starting treatment (starttreatdate), treatment end date (txenddate), pulmonary or extra-pulmonary TB (pulmextrapulm), culture (culture), sputum smear status (sputsmear), drug resistance (anyres), previous diagnosis (prevdiag), BCG status(bcgvacc), Year of BCG vaccination (bcgvaccyr), overall outcome (overalloutcome), cause of death (tomdeathrelate), socio-economic status quintiles (natquintile), and date of death (dateofdeath). Nested variables have been accounted for (i.e data of death has had an entry added for cases that are known to have not died), so that true missingness for all variables is estimated."),
      booktabs = TRUE) %>%
  add_header_above(c(" ", "Pre 2009" = 2, "Post 2008" = 2)) %>% 
  kable_styling(latex_options = "HOLD_position") 
```

For nested variables with rare outcomes assuming the top level variable value can mask the underlying amount of missing data. An alternative approach is to filter the data for the top level variable required for the nested variable to be defined and to then compute the proportion of these notifications that are missing data for the outcome of interest. For the date of starting treatment this approach leads to an estimate of `r missing_stats[["date_treat"]]` being missing, which is more complete than previously estimated. For cases that are known to have completed treatment `r missing_stats[["date_treat_end"]]` are missing a date for the end of treatment. In notifications that are known to have died, `r missing_stats[["date_death"]]` were missing the date of death and `r missing_stats[["cause_death"]]` were missing the cause of death. In any analysis where these variables are used the missing data for these variables will need to be carefully adjusted for. In particular, if cause of death is used it must be clearly stated that it is highly missing and results based on this variable should be properly caveated.

#### Drivers of Variable completeness

Missing data may be MAR or MNAR, which may introduce biases into any analyses based on these data. This is of particular importance for variables that have high levels of missingness, as any introduced bias is likely to have a greater impact on the overall results, and for variables that are used extensively in analyses later in this thesis. Unfortunately MNAR data cannot be detected, so bias from this source cannot be discounted. However, it is possible to detect potential MAR mechanisms from observed variables that would not necessarily be included in a model used for analysis. Although these associations may themselves be caused by an external factor. In the following section I explore variables associated with data being missing for several key variables including: BCG status, year of BCG vaccination, date of death, cause of death, date of symptom onset, date of diagnosis, date of starting treatment and date of ending treatment. All of these variables were shown to have high levels of missing data in the previous section and they will all be used extensively throughout this thesis.

In order to explore the drivers of missing data I have reformulated the problem as a logistic regression for each variable of interest, with the outcome being data completeness (complete/missing). This allows variables that are hypothesised to be related to missing data to be adjusted for and their independent impact on data completeness to be estimated. Unlike classic approaches to missing data, such as multiple imputation by chained regression (MICE),[@Groothuis-oudshoorn] this is not an imputation. The details of the approach are discussed below.

##### Statistical analysis

In order to reformulate missing data as a logistic regression we took the following steps:

1. For the variable of interest create a new temporary binary variable, called data status, that is "Missing" when the variable of interest is missing and "Complete" when it is not. Specify "Complete" as the baseline.

1. For nested variables exclude notifications that do not have the top level outcome required by the variable of interest. An example of this is excluding cases that did not die, or have a missing overall outcome, when investigating TB mortality.

1. Specify the hypothesised drivers of missingness for the variable of interest. These should be variables with a reasonable hypothesis for how they would drive missingness in the variable of interest. They must also be relatively complete as this approach does not impute missing confounder data.

1. Fit a logistic regression model with the temporary data status variable as the outcome, adjusting for the hypothesised drivers of missingness. 

1. Exponentiate the returned coefficients, and confidence intervals so that they represent Odds Ratios (ORs). 

1. Refit the model, dropping each variable in turn and then comparing the updated model with the full model using a likelihood ratio test.

1. Interpret the results, using the estimated size of the effect, the width of the confidence intervals and the size of the Wald and likelihood ratio test p values to determine which variables are related to missingness for the variable of interest. Evidence should be interpreted on a spectrum, rather than using arbitrary significance cut-offs.[@Sterne2001] To avoid issues of multiple testing the level of evidence should be weighted based on the number of variables adjusted for and the number of outcomes explored.

For all outcomes considered I adjusted for the same set of demographic variables that were both highly complete and also plausibly linked to missingness for all outcomes considered. These were: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Complete case analysis has been used, with the dataset limited to notifications from 2010 and on-wards as socio-economic status was not collected prior to this.

```{r deep-dive-missing, include = FALSE}
if (regen_results) {
  
    # Filter to only look at 2009 and move to year as factor ------------------
   ets_post_2009 <- ets %>%
     filter(year > 2009) %>%
     mutate(year = factor(year))
   
    # Set default exploratory variables --------------------------------------
    confounders_var <- c("year", "sex", "agegrp", "ethgrp", "ukborn", "natquintile")
    confounder_names <- c("Year", "Sex", "Age", "Ethnic group", "UK birth status", "Socio-economic status")
    
    model_variable_missingness <- purrr::partial(model_variable_missingness, list(
       confounders = confounders_var, confounder_names = confounder_names
    ))
   # BCG vac -----------------------------------------------------------------
   
   bcg_missingness <- ets_post_2009 %>%
     model_var_missing(var = "bcgvacc")
   
   
   
   # Year of BCG -------------------------------------------------------------
   
   bcg_year_missingness <- ets_post_2009 %>%
     filter(bcgvacc == "Yes") %>%
     model_var_missing(var = "bcgvaccyr")
   
   
   # Date of death -----------------------------------------------------------
   death_date_missingness <- ets_post_2009 %>%
     filter(overalloutcome == "Died") %>%
     model_var_missing(var = "dateofdeath")
   
   # cause of death ----------------------------------------------------------
   death_cause_missingness <- ets_post_2009 %>%
     filter(overalloutcome == "Died") %>%
     model_var_missing(var = "tomdeathrelat")
   
   
   # date symptom onset ------------------------------------------------------
   
   date_symptoms_missingness <- ets_post_2009 %>%
     model_var_missing(var = "symptonset")
   
   
   # date of diag ------------------------------------------------------------
   
   date_diag_missingness <- ets_post_2009 %>%
     model_var_missing(var = "datediag")
   
   
   # date of starting treatment ----------------------------------------------
   date_treat_start_missingness <- ets_post_2009 %>%
     model_var_missing(var = "starttreatdate")
   
   
   
   # date of ending treatment ------------------------------------------------
   date_treat_end_missingness <- ets_post_2009 %>%
     filter(overalloutcome %in% c("Treatment completed")) %>%
     model_var_missing(var = "txenddate")
   
   
   
   model_miss_results <- list(bcg_missingness, bcg_year_missingness,
                              death_cause_missingness, date_symptoms_missingness,
                              date_diag_missingness, death_date_missingness,
                              date_treat_start_missingness, date_treat_end_missingness)
   
   names(model_miss_results) <- c("bcgvacc", "bvcvaccyr", "tomdeathrealat",
                                  "symptonset", "datediag", "dateofdeath",
                                  "starttreatdate", "txenddate")
   
   save_data(model_miss_results, "model_miss_results")
}else{
   model_miss_results <- read_data("model_miss_results")
}
```

## Patient and public involvement

We did not involve patients or the public in the design or planning of this study.

# Results

## BCG status

It is clear that BCG status is missing with a MAR mechanism for the variables considered `r pretty_tabref("bcgvacc-miss")`. BCG data missingness is strongly associated with year of notification, sex age, ethnic group, and socio-economic status. It appears that after adjusting for other variables data completeness increased from 2010 until 2012 but has since showed no clear trend. Men appear to be more likely than women to have a missing BCG status, with the non-UK born also being more likely than the UK born to be missing BCG status. The proportion of those missing BCG status increases with age, with those aged 65+ being over 4 times more likely to be missing BCG status than those aged 0-14 years old. There is also evidence to suggest that notifications in the lowest socio-economic group are more likely to have a missing BCG status but there was no clear evidence of a trend across socio-economic quintiles. The White ethnic group was more likely to have a missing BCG status than any other ethnic group.

```{r bcgvacc-miss}
kable(model_miss_results[["bcgvacc"]],
      caption = pretty_tabref("bcgvacc-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for BCG vaccination as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that BCG status is missing at random for the variables considered."), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, 
                latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm") %>% 
  kable_styling(latex_options = "hold_position")
```

## Year of BCG vaccination

As for BCG status, year of BCG vaccination is also clearly missing with MAR mechanisms for the variables considered (`r pretty_tabref("bcgvaccyr-miss")`). As for BCG status men were more likely to have a missing year of BCG vaccination as were the non-UK born. Older notifications were again more likely to have missing data, with those aged 65+ being more than 2 times more likely to have a missing year of vaccination. However, unlike BCG vaccination status, year of notification shows a clear trend of increasing data completeness from 2010 until 2015. Additionally, for year of BCG vaccination the White ethnic group is more likely to have complete data than any other ethnic group, with those of Black-Caribbean descent being over 3 times more likely to have a missing year of BCG vaccination. Socio-economic status is  highly associated with year of vaccination being missing but there is little clear evidence of a trend. The second, and third, poorest quintiles were more likely to have a missing year of vaccination. Whilst the richest, and second richest quintiles were less likely to have a missing year of vaccination.

```{r bcgvaccyr-miss}
kable(model_miss_results[["bvcvaccyr"]], format = "latex",
      caption = pretty_tabref("bcgvaccyr-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for year of BCG vaccination as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that year of BCG vaccination is missing at random for the variables considered."), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm")
```

## Date of death

For date of death there is some evidence that data is missing with an MAR mechanism for ethnic group and socio-economic status, with little evidence for any other association (`r pretty_tabref("dateofdeath-miss")`). These associations should be interpreted carefully due to the strength of the evidence when compared to the number of tests conducted, there is a high likelihood of a type 1 error. Whilst the confidence intervals were wide for all ethnic groups there was some weak indication that the White ethnic group were more likely to have a complete date of death than other ethnic groups. Similarly, those in the lowest socio-economic group were somewhat more likely to have a complete date of death than other quintiles. The reduction in the levels of evidence found for case of death may be linked to the reduction in power for this outcome, as mortality is a rare outcome.

```{r dateofdeath-miss}
kable(model_miss_results[["dateofdeath"]],
      caption = pretty_tabref("dateofdeath-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of death as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that there is some evidence that date of death is missing at random for ethnic group, with weaker evidence for all other variables."), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm") %>% 
  kable_styling(latex_options = "hold_position")
```

## Cause of death

For cause of death there is less evidence of an MAR mechanism, with little evidence of an association for year, sex, age, or socio-economic group (`r pretty_tabref("tomdeathrealat-miss")`). There was, however, strong evidence of an association with ethnic group and very weak evidence of an association with UK birth status. The White ethnic group was less likely to have an incomplete cause of death when compared to the majority of other identified ethnic groups but there was evidence to suggest that cause of death was more likely to be missing in those identifying as being of Black-Caribbean, Black-Other, Indian and Bangladeshi descent. The confidence intervals for these estimates were wide, indicating that these estimates may not be reliable. There was again some weak evidence to suggest that the UK born were more likely to be missing a cause of death than the non-UK born, which reverses the trend observed in the other variables explored. The reduction in the levels of evidence found for case of death may be linked to the reduction in power for this outcome, as mortality is a rare outcome.

\newpage

```{r tomdeathrealat-miss}
kable(model_miss_results[["tomdeathrealat"]],
      caption = pretty_tabref("tomdeathrealat-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for cause of death as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that cause of death is missing at random for ethnic group and UK birth status, with little evidence for any other variables"), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm") %>% 
  kable_styling(latex_options = "hold_position")
```

## Date of symptom onset

For date of symptom onset there was strong evidence of an MAR mechanism for all variables considered, except for sex (`r pretty_tabref("symptonset-miss")`). As found previously, the likelihood of date of symptom onset being missing reduced with year of notification. Children (0-14 years old) were more likely to have a missing date of symptom onset than any other age group as were those in any socio-economic quintile when compared to the poorest group. UK born cases were more likely to have a complete date of symptom onset than non-UK born cases, with the White ethnic group being more likely to have a missing date of symptom onset than most other ethnic groups.

```{r symptonset-miss}
kable(model_miss_results[["symptonset"]],
      caption = pretty_tabref("symptonset-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of symptom onset as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that date of symptom onset is missing not at random for the variables for all variables considered, except for sex."), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm") %>% 
  kable_styling(latex_options = "HOLD_position")
```

## Date of diagnosis

For date of diagnosis there was again strong evidence for an MAR mechanism for all variables considered, except for sex for which there was very weak evidence (`r pretty_tabref("datediag-miss")`). Increasing completeness was found for year of notification as seen previously, as was an increased likelihood of missing data in males and the non-UK born. The White ethnic group was less likely to be missing data on the data of diagnosis as compared to the majority of other ethnic groups, as were the poorest socio-economic group compared to all other socio-economic quintiles. Children (0-14 years old) were again more likely to be missing data than adults in any age group.

```{r datediag-miss}
kable(model_miss_results[["datediag"]],
      caption = pretty_tabref("datediag-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of diagnosis onset as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that date of diagnosis is missing at random for the variables for all variables considered, except for sex."), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm") %>% 
  kable_styling(latex_options = "hold_position")
```

## Date of starting treatment

For date of starting treatment there is little evidence that missing data is associated with any variable considered, except for year of notification (`r pretty_tabref("starttreatdate-miss")`). Variable completeness improved year-on-year, with a 96% drop in missing data in 2015 compared to 2010. 

```{r starttreatdate-miss}
kable(model_miss_results[["starttreatdate"]],
      caption =  pretty_tabref("starttreatdate-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of starting treatment as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. There is little evidence that the missing data for the date of starting treatment is associated with any variable considered, except for year of notification."), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>%   
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm") %>% 
  kable_styling(latex_options = "hold_position")
```


## Date of ending treatment

For date of ending treatment there is evidence that missing data is associated with year of notification and weaker evidence of an association with ethnic group and socio-economic status, with little evidence for any other variable  (`r pretty_tabref("txenddate-miss")`). As found previously, variable completeness increased over time. There was some evidence that poorest socio-economic group was more likely to be missing the date of ending treatment but the evidence for this was mixed. The White ethnic group was more somewhat likely to be missing date of treatment ending than most other ethnic groups. 

```{r txenddate-miss}
kable(model_miss_results[["txenddate"]],
      caption = pretty_tabref("txenddate-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of starting treatment as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. There is little evidence that the missing data for the date of starting treatment is associated with any variable considered, except for year of notification."), booktabs = TRUE, longtable = TRUE) %>% 
  kable_styling(font_size = 8, latex_options = c("repeat_header")) %>% 
  column_spec(c(1), width = "1.5cm") %>% 
  column_spec(c(4), width = "2cm") %>% 
  column_spec(c(6, 7), width = "1.5cm") %>% 
  kable_styling(latex_options = "hold_position")
```

#### Biases in the ETS

Routine observational datasets are subject to numerous potential biases, such as selection bias, recall bias, measurement bias, and unmeasured confounding.[@Benchimol2016a] Additionally, as the data has not been collected with a specific analysis in mind there maybe issues with the specificity of variables. The ETS system is likely to suffer from all of the above biases to some extent, which must be accounted for as far as possbile, and explicitly stated at every level of analysis. The most important consideration is that the ETS system is unlikely to be representative of the general population as it contains only notified TB cases that occurred in England during the study period, research questions must therefore be either limited to active TB patients, or when extended to the general population the differing population demographics must be accounted for. If this is not done then any results may be due to selection bias. Additionally, multiple variables may suffer from misclassification bias, including BCG status which can be assessed via vaccination record, the presence of a scar, or case recall: this may lead to spurious associations.[@Fewell2007] Validation studies would be required to account for this, which is beyond the scope of this thesis. 


# Discussion

### Statement of primary findings


In the ETS system I found a high degree of missing data for several important variables. I also found that there is likely to be strong missing at random (MAR) mechanism underlying this missing data for multiple variables. Several factors are strongly associated with data being missing for many variables, including UK birth status, ethnic group, socio-economic status and year. These MAR mechanisms must be adjusted for in future analysis to avoid bias. I found that date variables in particular suffered from changing data completeness over time, which may introduce spurious temporal trends if not fully understood. I also found that for several variables, including the date of symptom onset, there was a large degree of recall bias when aggregating by day or month. Several variables, including date of notification and date of starting treatment, showed a seasonal trend with a maximum in the summer months. The date of ending treatment showed less evidence of a seasonal trend.

### Strengths and limitations of the study

### Strengths and limitations in comparison to the literature
    
### Meaning of the study

### Unanswered questions and future research




**Acknowledgements**

The authors thank the TB section at Public Health England (PHE) for maintaining the Enhanced Tuberculosis Surveillance (ETS) system; all the healthcare workers involved in data collection for the ETS.

**Contributors**

SA, HC, and EBP conceived and designed the work. SA undertook the analysis with advice from all other authors. All authors contributed to the interpretation of the data. SA wrote the first draft of the paper and all authors contributed to subsequent drafts. All authors approve the work for publication and agree to be accountable for the work.

**Funding** 

SEA, HC, and EBP are funded by the National Institute for Health Research Health Protection Research Unit (NIHR HPRU) in Evaluation of Interventions at University of Bristol in partnership with Public Health England (PHE). The views expressed are those of the author(s) and not necessarily those of the NHS, the NIHR, the Department of Health or Public Health England.

**Conflicts of interest** 

HC reports receiving honoraria from Sanofi Pasteur, and consultancy fees from AstraZeneca, GSK and IMS Health, all paid to her employer.

**Accessibility of data and programming code**

The code and data for the analysis contained in this paper can be found at: 


# References

<div id = 'refs'></div>

## Results *Copy to top*


# Supplementary Information: Explore and Evaluate the Mechanisms for Missing Data in the Enhanced Tuberculosis Surveillance System

Sam Abbott, Hannah Christensen, Ellen Brooks-Pollock



