---
title: "Evaluating the Mechanisms for Missing Data in the Enhanced Tuberculosis Surveillance System"
author: "Sam Abbott, Hannah Christensen, Ellen Brooks-Pollock"
output: 
      html_document:
      word_document:
        reference_docx: resources/style.docx
vignette: >
  %\VignetteIndexEntry{Explore and Evaluate the Mechanisms for Missing Data in the Enhanced Tuberculosis Surveillance System}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
always_allow_html: true
bibliography: resources/library.bib  
csl: resources/bmj.csl
---


```{r setup, include=FALSE}
## Run code that requires raw data - see data availability for details of how to access the data.
## Used to control which chunks run
regen_results <- FALSE

## Make folders for data and fig storage and return as a path
data_path <- ETSMissing::make_results_folder("paper/data")
fig_path <- ETSMissing::make_results_folder("paper/figs")

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, cache = FALSE,
  cache.path = paste0("cache/", "paper" ,"/"),
  fig.width = 8, 
  fig.height = 8)
```


```{r packages, include = FALSE}
library(here)
library(tidyverse)
library(knitr)
library(future)
library(purrr)
library(furrr)
library(forcats)
library(gridExtra)
library(prettypublisher)
library(ETSMissing)
```


```{r utility, include = FALSE}
## Set conveniance function paths using {purrr}
save_data <- purrr::partial(ETSMissing::save_data, path = data_path)
save_figure <- purrr::partial(ETSMissing::save_figure, path = fig_path)
read_data <- purrr::partial(ETSMissing::read_data, path = data_path)
show_figure <- purrr::partial(ETSMissing::show_figure, path = fig_path)
## Set theme
PaperTheme <- theme_minimal() +
  theme(legend.position = "top", text = element_text(size = 12))

ggplot2::theme_set(PaperTheme)
```

**Authors:**

Sam Abbott, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol, UK

Hannah Christensen, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol, UK

Ellen Brooks-Pollock, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol, UK

**Correspondence to:** Sam Abbott, Bristol Medical School: Population Health Sciences, University of Bristol, Bristol BS8 2BN, UK; sam.abbott@bristol.ac.uk; 01173310185

**Words:** *Title:* 12 *Abstract:* 299  *Paper:* 3196

# Abstract

## Background

The Enhanced Tuberculosis Surveillance (ETS) system is a routine surveillance system that collects data on all notified tuberculosis (TB) cases in England and is routinely used in research. Routine data often has a large amount of missing data which may introduce bias to analyses. This study explores the evidence for associations between missingness in several outcomes and demographic variables. Any such associations may introduce bias if not accounted for.

## Methods

We used data on all notifications in the ETS for England (2000-2015). We summarised the proportion of missing data and then used logistic regression to explore the associations between missingness and demographic variables for the following outcomes: drug resistance; BCG status and year; date of symptom onset, diagnosis, notification, starting treatment, finishing treatment and death; and cause of death. For all date variables, we visualised the distribution annually and by month, identifying variables at risk of bias. 

## Results

All demographic variables considered were associated with data being missing for multiple outcomes. Missingness was not associated with all demographic variables for all outcomes. Associations that were present did not all have the same direction of effect. We found that the date of symptom onset and the date of ending treatment had a high proportion of cases occurring in January and on the 1st and 14th of each month indicating the presence of potential bias. 

## Conclusions

Missingness in outcomes was associated with multiple demographic variables. These associations could not be generalised, preventing a systematic approach to dealing with missingness. The identified associations may induce bias, meaning that complete case analysis should not be used for this data source - or other similar surveillance data. Our findings should be used motivate the use of imputation and to inform the specification of imputation models for similar surveillance data. 

## Keywords

Tuberculosis, surveillance, missingness, imputation

## Key messages


# Introduction

*Background*

The Enhanced Tuberculosis Surveillance (ETS) system is a routine surveillance system - with a similar structure to other such systems - that collects data on all notified tuberculosis (TB) cases in England. It is routinely used to study the epidemiology of TB. Routine data often has a large amount of missing data which may not be fully accounted for when used in analyses. 

*Detail*

*Describe the ETS and use cases*

Missing data can take several forms, data that are missing completely at random (MCAR), data that are missing at random (MAR) and data that are missing not at random (MNAR).[@Sterne2009a] Data that are MAR are missing with a mechanism that is conditional on observed variables, whilst MNAR are missing with a mechanism that is conditional on variables that are not observed. Data that is MAR, and MNAR may lead to biases when analysing the data, however it is not possible to deduce from the observed data what the mechanism driving missing data is. Therefore, it is necessary to account for these potential biases during the analysis stage. This is possible using a variety of methods such as scenario analysis accounting for the 'best' and 'worst' case scenarios, and multiple imputation of missing data using additional variables in the data-set to inform the imputation model.[@Sterne2009a] Common practice is to include all variables included in the analyses in the imputation model, these variables may or may not be those at most risk of introducing bias due to an MAR mechanism.

*Aim*

This study aims to explore the evidence for associations between missingness in several key outcomes and demographic variables. Any such associations may introduce bias if not accounted for.

# Methods

## Enhanced tuberculosis surveillance (ETS) system

```{r load-ets, messages = FALSE, eval = regen_results}
## Load in and clean the ETS extract
## Data cleaning + munging is packaged seperately
## See here: 
if (regen_results) {
  ets <- ETSMissing::read_data("clean_ets_2016", path = here("data-raw/tb_data/tbinenglanddataclean"))
}
```

The ETS is a database that collects demographic, clinical, and microbiological data on all notified TB cases in England and is maintained by Public Health England (PHE). Notification is required by law, with health service providers having to inform PHE of all confirmed TB cases.[@PHE2017] Data collection began in 2000 and was expanded, with additional variables, with the launch of a web-based system in 2008.[@Kriujshaar2007] It is updated annually with de-notifications, late notifications and other updates. A descriptive analysis of TB epidemiology in England is published each year, which reports on data collection, cleaning, and trends in TB incidence at both a national, and sub-national level.[@PHE2017] Data on all notifications (114,820 notifications) from the ETS system from 2000 to 2015 were obtained from PHE via an application to the TB monitoring team. The code used for data cleaning is available as an R package (https://zenodo.org/badge/latestdoi/93072437).

### Data completeness

As the ETS is aggregated across England, from a variety of sources, missing data are inevitable. This takes two forms: under-reporting of notified cases, of which there is some evidence in the literature,[@Pillaye2003] and data missing for a notified case. The former is particularly problematic as apart from using comparative studies the characteristics of those that are not notified is unknown. For variables that are missing data within the data-set the proportion of missing data can be calculated but care must be taken to account for nested variables (such as cause of death being dependent on date of death). To account for this when estimating the proportion of missing data we have assumed that nested variables take the value of their parent variable when missing. This approach may be biased for rare outcomes (such as death in the ETS) - for this reason we have also estimated the proportion of missing data by filtering top level variables required for the nested variable to be defined and then computed the proportion of notifications that were missing data for the outcome of interest.  

```{r miss-dat-munge, include = FALSE, eval = regen_results}
if (regen_results) {
  ## See package docs (?ETSMissing::function) for further implementation details 
  # Account for nested data -------------------------------------------------
  nest_filt_ets <- ets %>%
    ETSMissing::account_for_nested_missing()
  
  # Plot nested missing data ------------------------------------------------
  missing_strut <- nest_filt_ets %>%
    ETSMissing::plot_nested_missing()
  
  save_figure(missing_strut, "plot-missing-struct")
  
  # Estimate missing ness pre and post 2009 ---------------------------------
  miss_ets_pre_2009 <- nest_filt_ets %>%
    dplyr::filter(year < 2009) %>%
    ETSMissing::nested_missing_table()
  
  miss_ets_post_2008 <- nest_filt_ets %>%
    dplyr::filter(year > 2008) %>%
    ETSMissing::nested_missing_table()
  
  save_data(miss_ets_pre_2009, "miss_ets_pre_2009")
  save_data(miss_ets_post_2008, "miss_ets_post_2008")
  
  # Summary stats -----------------------------------------------------------
  ## For nested variables an alternative measure of missing data is to consider the number of missing data
  ## points when top level outcome is known
  missing_stats <- ETSMissing::summarise_missingness(ets)
  
  save_data(missing_stats, "missing_stats")
}
```

### Drivers of Variable completeness

**Overview**

Missing data may be MAR or MNAR, which may introduce biases into any analyses based on these data. Unfortunately MNAR data cannot be detected, so bias from this source cannot be discounted. However, it is possible to detect potential MAR mechanisms from observed variables that may not be included in a model used for analysis. Here we describe a method for this and apply it to several key outcomes including: Drug resistance (any treatment), BCG status, year of BCG vaccination, date of death, cause of death, date of symptom onset, date of diagnosis, date of starting treatment and date of ending treatment. 

We reformulated the problem as a logistic regression for each variable of interest, with the outcome being data completeness (complete/missing). This allows variables that are hypothesised to be related to missing data to be adjusted for and their independent impact on data completeness to be estimated. This approach does not account for missingness within exploratory variables.

**Statistical details**

We took the following steps:

1. For the variable of interest create a new temporary binary variable, called data status, that is "Missing" when the variable of interest is missing and "Complete" when it is not. Specify "Complete" as the baseline.

1. For nested variables exclude notifications that do not have the top level outcome required by the variable of interest. An example of this is excluding cases that did not die, or have a missing overall outcome, when investigating TB mortality.

1. Specify the hypothesised drivers of missingness for the variable of interest. These should be variables with a reasonable hypothesis for how they would drive missingness in the variable of interest. They must also be relatively complete as this approach does not impute missing confounder data.

1. Fit a logistic regression model with the temporary data status variable as the outcome, adjusting for the hypothesised drivers of missingness. 

1. Exponentiate the returned coefficients, and confidence intervals so that they represent Odds Ratios (ORs). 

1. Refit the model, dropping each variable in turn and then comparing the updated model with the full model using a likelihood ratio test.

1. Interpret the results, using the estimated size of the effect, the width of the confidence intervals and the size of the Wald and likelihood ratio test p values to determine which variables are related to missingness for the variable of interest. Evidence should be interpreted on a spectrum, rather than using arbitrary significance cut-offs.[@Sterne2001] To avoid issues of multiple testing the level of evidence should be weighted based on the number of variables adjusted for and the number of outcomes explored.

For all outcomes considered we adjusted for the same set of demographic variables that were both highly complete, plausibly linked to missingness for all outcomes considered, and likely to be present in other comparable surveillance data-sets. These were: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status, socio-economic status (national quintiles), and PHE centre (region). Complete case analysis was used, with the data-set limited to notifications from 2010 and on-wards as socio-economic status was not collected prior to this. The code for this approach is available as an R package online (https://doi.org/10.5281/zenodo.3492200).

```{r missing-associations, include = FALSE}
if (regen_results) {
   # Filter to only look at 2009 and move to year as factor ------------------
ets_post_2009 <- ets %>%
  filter(year > 2009) %>%
  mutate(year = factor(year)) %>% 
  mutate(phec = phec %>% 
           forcats::fct_infreq())
 # Outcome list -----------------------------------------------------------
 
 ## List out outcomes to explore
 outcomes <- tibble(outcome = c("bcgvacc", "bcgvaccyr", "dateofdeath",
                                  "tomdeathrelat", "symptonset", "datediag",
                                  "starttreatdate", "txenddate", "anyres"))
 
 ## Outcome specific data cleaning to deal with nesting issues etc.
 outcomes <- outcomes %>% 
   ## First no outcomes for which no cleaning is needed
   dplyr::mutate(cleaning = case_when(outcome %in% c("bcgvacc", "symptonset", "datediag",
                                                      "starttreatdate", "anyres") ~ c(function(df){
                                                        return(df)
                                                        }),
   ## Then variables for which cases must have died for there to be data
                                      outcome %in% c("dateofdeath", "tomdeathrelat") ~ c(function(df){
                                        df <- dplyr::filter(df, overalloutcome == "Died")
                                        return(df)
                                        }),
  ## Then variables for which cases must have completed treatment for there to be data
                                       outcome %in% c("txenddate") ~ c(function(df){
                                         df <- dplyr::filter(df, overalloutcome %in% c("Treatment completed"))
                                         return(df)
                                         }),
 ## Then variables for which cases must have been BCG vaccinated for there to be data
                                        outcome %in% c("bcgvaccyr") ~ c(function(df){
                                          df <- dplyr::filter(df, bcgvacc == "Yes")
                                          return(df)
                                          })
 ))

 ## Set default exploratory variables --------------------------------------
 confounders_var <- c("year", "sex", "agegrp", "ethgrp", "ukborn", "natquintile", "phec")
 confounder_names <- c("Year", "Sex", "Age", "Ethnic group", "UK birth status", "Socio-economic status", "Public Health England centre")
 
 ## Run analysis  -----------------------------------------------------------
 ## See ?model_variable_missingness for details of model implementation.
 future::plan(future::multiprocess)
 
 results <- outcomes %>% 
  dplyr::mutate(missing_table = furrr::future_map2(outcome, cleaning, ~
                                                 ETSMissing::model_variable_missingness(df = .y(df = ets_post_2009), var = .x, 
                                                                                        confounders = confounders_var,
                                                                                        confounder_names = confounder_names),
                                               .progress = TRUE))
 
 ## Save analysis
 save_data(results, "results")
}else{
## Read in results if not computed
results <- read_data("results")
}
```

### Assessing temporal biases in reporting

In addition to data being MAR there may be other biases present. For date variables this is a particular issue with recall bias, reporting bias etc. potentially distorting temporal trends. We explore this by summarising the distribution of all date variables by month and then by day of the month, stratified by the introduction of the web-based ETS system (2009). The date of notification is then used as a baseline for the inherent seasonal or monthly reporting structure. This approach allows potential biases to be identified and compared across the current and pre-web ETS. For each date data was restricted with only data from 2000 until 2015 being used. 


```{r explore-detection-time-variables, eval = regen_results, include = FALSE}
if (regen_results) {
  plots <- results %>% 
  add_case(outcome = "caserepdate", cleaning = c(function(df){return(df)})) %>% 
  dplyr::select(-missing_table) %>% 
  dplyr::filter(grepl("date", outcome) | outcome %in% c("symptonset")) %>% 
  dplyr::mutate(trends = furrr::future_map2(outcome, cleaning, ~
                                                     ETSMissing::plot_date_variable_missingness(
                                                       df = .y(df = ets), var = .x,
                                                       start_year = 2000, end_year = 2015,
                                                       split_year = 2009),
                                                 .progress = TRUE)) %>% 
  dplyr::mutate(type = map(trends, names)) %>% 
  tidyr::unnest(type, trends) %>% 
  tidyr::pivot_wider(names_from = "type",
              names_prefix = "trends_",
              values_from = "trends")


 ## Save plots
 save_data(plots, "plots")
 
 ## Munge together and save as pngs
plots %>% 
  dplyr::mutate(munged_plots = purrr::map2(trends_by_month, trends_by_day, 
                             ~ gridExtra::grid.arrange(.x + labs(title = "a.)"),
                                            .y + labs(title = "b.)"))
                             )) %>% 
  dplyr::mutate(tmp = purrr::walk2(munged_plots, outcome,
                                   ~ save_figure(.x, paste0("trends-for-", .y))))
}
```

## Patient and public involvement

We did not involve patients or the public in the design or planning of this study.

# Results

## Data completeness

We found high completeness for common demographic variables such as sex, age, ethnic group and UK birth status (`r prettypublisher::pretty_supfigref("plot-missing-struct")`, `r prettypublisher::pretty_tabref("missing-var-tabs")`). More problematically, BCG status and year of BCG status had a high percentage missing, even after accounting for the introduction of national collection of these variables in 2008.[@PHE2017] Socio-economic status (as national quintiles) was not collected until 2010 but after this point is highly complete.[@PHE2017] Comparing pre 2009 and post 2008 in `r prettypublisher::pretty_tabref("missing-var-tabs")` (`r prettypublisher::pretty_supfigref("plot-missing-struct")`) we see completeness changes over time.[@PHE2016; @PHE2017] There was some evidence that groups of variables had correlated missing data (`r prettypublisher::pretty_supfigref("plot-missing-struct")`).

```{r missing-var-tabs}
## Read in results
miss_ets_pre_2009 <- read_data("miss_ets_pre_2009")
miss_ets_post_2008  <- read_data("miss_ets_post_2008")
missing_stats <- read_data("missing_stats")

## Tabulate
miss_ets <- miss_ets_pre_2009 %>% 
  dplyr::select(variable, `2000-2008` = reported) %>% 
  dplyr::left_join(miss_ets_post_2008 %>% 
                     dplyr::select(variable, `2009-2015` = reported), by = "variable") %>% 
  map_variable_names() %>% 
  rename(Variable = variable)
                     
                     

knitr::kable(miss_ets,
      caption = prettypublisher::pretty_tabref("missing-var-tabs", "Percentage of missing data from the ETS for a subset of variables, prior to the web-based system (pre 2009) and post (post 2008) by variable, ordered by the  percentage missing for a subset of variables. Nested variables have been accounted for (i.e data of death has had an entry added for cases that are known to have not died), so that true missingness for all variables is estimated."))
```

By filtering nested variables - rather than by using replacement -  we found the date of starting treatment was `r missing_stats[["date_treat"]]` missing, which is more complete than previously estimated. For cases that were known to have completed treatment `r missing_stats[["date_treat_end"]]` were missing a date for the end of treatment. In notifications that were known to have died, `r missing_stats[["date_death"]]` were missing the date of death and `r missing_stats[["cause_death"]]` were missing the cause of death. 

## Drivers of Variable completeness


### Drug resistance

There was evidence that drug resistance was missing with a MAR mechanism for all variables considered (`r prettypublisher::pretty_tabref("anyres-miss")`), excepting year of notification. Men were less likely to be missing than women. Children were much more likely to have a missing drug resistance status than any other age group. The white ethnic group were less likely to be missing drug resistance than all other ethnic groups, excepting the Chinese ethnic group. The UK born population was more likely to be missing as were those from higher economic quintiles. Notifications in London were more likely to be missing drug resistance status than for most other PHE centres. 

```{r anyres-miss}
ETSMissing::pull_results(results, "anyres") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_tabref("anyres-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for drug resistance (to any treatment) as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables."))
```

### BCG status and year of BCG vaccination

Similarly to drug resistance there was evidence that BCG status was missing with a MAR mechanism for all variables considered (`r prettypublisher::pretty_tabref("bcgvacc-miss")`) with the  stronger evidence for an association with year but reduced evidence of an association with socio-economic status. After adjusting for other variables data completeness increased from 2010 until 2012 but has since showed no clear trend. Men appeared to be more likely than women to have a missing BCG status, with the non-UK born also being more likely than the UK born to be missing BCG status. The proportion of those missing BCG status increased with age, with those aged 65+ being over 4 times more likely to be missing BCG status than those aged 0-14 years old. The White ethnic group was more likely to have a missing BCG status than any other ethnic group. London was associated with less reduced missingness for BCG status compared to other PHE centres. 

Missingness for year of BC vaccination had similar associations as BCG status. However, there was less evidence of an association with sex, the white ethnic group were less likely to have a missing status than other ethnic groups, and there was strong evidence of an association with socio-economic status with those in the lowest quintile being more likely to have a missing year of BCG vaccination. London was much more likely to be missing BCG status than any other PHE centre, a reversal of the relationship observed for BCG status 

```{r bcgvacc-miss}
ETSMissing::pull_results(results, "bcgvacc") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_tabref("bcgvacc-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for BCG vaccination as an outcome, adjusted for: year, sex, age (grouped as 0-14 
                                year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. 
                                Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all 
                                explanatory variables. The model indicates that BCG status is missing at random for the variables considered."))
```

### Date of symptom onset

For date of symptom onset there was strong evidence of an MAR mechanism for all variables considered, except for sex (`r prettypublisher::pretty_tabref("symptonset-miss")`). The likelihood of date of symptom onset being missing reduced with year of notification. Children (0-14 years old) were more likely to have a missing date of symptom onset than any other age group as were those in any socio-economic quintile when compared to the poorest group. UK born cases were more likely to have a complete date of symptom onset than non-UK born cases, with the White ethnic group being more likely to have a missing date of symptom onset than most other ethnic groups. London was again associated with a increased level of missing data compared to other PHE centres

```{r symptonset-miss}
ETSMissing::pull_results(results, "symptonset") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_tabref("symptonset-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of symptom onset as an outcome, adjusted for: 
                                year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For 
                                socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before 
                                this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that date of symptom onset is missing 
                                not at random for the variables for all variables considered, except for sex."))
```

### Date of diagnosis

For date of diagnosis there was again strong evidence for an MAR mechanism for all variables considered, except for sex (`r prettypublisher::pretty_suptabref("datediag-miss")`). Increasing completeness was found for year of notification as seen previously, as was an increased likelihood of missing data in males and the non-UK born. The White ethnic group was more likely to be missing data on the data of diagnosis as compared to the majority of other ethnic groups. The poorest socio-economic group was less likely to be missing data compared to all other socio-economic quintiles. Children (0-14 years old) were again more likely to be missing data than adults in any age group. As for other variables London had a much higher proportion of missing data than any other PHE centre. 

### Date of starting treatment and ending treatment

For date of starting treatment there was evidence that missing data was again associated with all variables considered, excepting UK birth status and socio-economic status (`r prettypublisher::pretty_suptabref("starttreatdate-miss")`). Missingness for the date of ending treatment was associated with fewer variables, with evidence only of associations between year, and PHE centre (`r prettypublisher::pretty_suptabref("txenddate-miss")`). For both variables the proportion of missing data reduced with the year of notification. London had a lower proportion of missing data when compared to most other PHE centres. For the date of starting treatment the White ethnic group were more likely to be missing data than other groups. Older age groups were also more likely to be missing data, as were males. 

### Date of death and cause of death.

For date of death there was little evidence of any association, except for PHE centre (`r prettypublisher::pretty_suptabref("dateofdeath-miss")`). This was also the case for cause of death but there was some additional evidence of an association with ethnic group (`r prettypublisher::pretty_suptabref("tomdeathrealat-miss")`). There was little evidence of a clear trend across ethnic groups for cause of death. As for other outcomes London was much more likely to be missing date of death than other PHE centres. This relationship was reversed for cause of death. Both date of death and cause of death had a small sample size and this may mean that these analyses were under-powered. 

## Assessing temporal biases in reporting

Notifications showed evidence of a strong seasonal trend with a peak in the number of notifications in May-July each year but had a near uniform distribution within each month (`r prettypublisher::pretty_suptabref("plot-trends-caserepdate")`). There was little evidence of strong biases in this reporting and there was little evidence to suggest that the introduction of the web-based ETS impacted the distribution of notifications or the levels of bias. The date of symptom onset showed evidence of an inverted seasonal trend - in comparison to notifications (`r prettypublisher::pretty_tabref("plot-trends-symptonset")`) . There was evidence that reporting in January may be biased with a much greater proportion of cases reported as having symptoms starting in this month than in any other. There was also evidence that cases were more likely to have symptoms start on the first and the 14th of each month, again indicating bias. Both of these apparent biases were reduced by the introduction of the web-based ETS but were still present. The date of ending treatment also showed some evidence of these biases and had the same inverted seasonal trend as the date of symptom onset (`r prettypublisher::pretty_suptabref("plot-trends-txenddate")`). The date of diagnosis, date of starting treatment and date of death showed a similar reporting structure to notifications although the strength of the seasonal trend was reduced (see the supplementary information). There was little clear evidence of biases in reporting either by month, or by day for these variables.



```{r plot-trends-symptonset, fig.cap = prettypublisher::pretty_figref("plot-trends-symptonset", "a.) Shows the proportion of cases with symptons starting in a given month for each year with some evidence of bias in January and reduced evidence of a seasonal trend. b.) Shows the proportion of cases with symptons starting on a given day for each month with a strong evidence of biased reporting on the first of the month and the 14th. Stratifying both figures based on the introduction of the web-based ETS indicates that the web-based ETS may have reduced these biases."), out.width = "60%", out.extra = ""}
show_figure("trends-for-symptonset")
```

# Discussion

### Statement of primary findings

We found a high degree of missing data for several variables in the ETS. All demographic variables considered were strongly associated with data being missing for multiple outcomes. However, not all outcome missingness was associated with all demographic variables and for those that were the direction of - or trend in - effect was not consistent. Missingness for drug resistance was associated with all variables - excepting year - with higher levels of missingness being associated with children, non-White ethnic groups, the UK born, higher socio-economic status, and the London PHE centre (though there was between PHE centre variation). In comparison, the associations with BCG status had a similar level of evidence but did not share the same trends with children being much less likely to have missing data than older adults, non-White ethnic groups having a lower levels of missing data than the White ethnic group, the non-UK born being more likely to be missing than the UK born, and the London PHE centre being less likely to be missing data than other PHE centres. Missingness for date and cause of death had less evidence of associations than other outcomes. We also found that date variables in particular suffered from changing data completeness over time. In addition, we found that both the date of symptom onset and the date of ending treatment had a higher than expected proportion of cases occurring in January each year and on the 1st and 14th of each month when compared to notification date. This may indicate the presence of reporting or recall bias. These potential biases were reduced after the launch of the web-based ETS but were still present.  

### Strengths and limitations of the study

*Work in progress - copied from chapter text*

Routine observational data-sets are subject to numerous potential biases, such as selection bias, recall bias, measurement bias, and unmeasured confounding.[@Benchimol2016a] Additionally, as the data has not been collected with a specific analysis in mind there maybe issues with the specificity of variables. The ETS system is likely to suffer from all of the above biases to some extent, which must be accounted for as far as possible, and explicitly stated at every level of analysis. The most important consideration is that the ETS system is unlikely to be representative of the general population as it contains only notified TB cases that occurred in England during the study period, research questions must therefore be either limited to active TB patients, or when extended to the general population the differing population demographics must be accounted for. If this is not done then any results may be due to selection bias. Additionally, multiple variables may suffer from misclassification bias, including BCG status which can be assessed via vaccination record, the presence of a scar, or case recall: this may lead to spurious associations.[@Fewell2007] Validation studies would be required to account for this. 


Unlike classic approaches to missing data, such as multiple imputation by chained regression (MICE),[@Groothuis-oudshoorn] this is not an imputation

### Strengths and limitations in comparison to the literature
    
### Meaning of the study

Missing data in the ETS was highly complex with changing completeness over time and associations with multiple demographic factors. The launch of the web-based ETS system was linked to reduced missing data, followed by improved completeness over subsequent years for multiple outcomes but for most outcomes this improvement then stalled. An updated data collection system may be able to reduce missing data - and MAR missingness - further. The nature of the associations could not be generalised over the outcomes considered with it being clear that individual mechanisms led to each. However, for all outcomes considered - that were well powered - there was evidence of associations with demographic variables. This indicates that missingness is likely to be not MCAR and hence must be accounted for in any analysis, ideally using multiple imputation. This means that complete case analysis should not be used on its own for this data source - or other similar surveillance data. Whilst many of the variables we considered may often be considered in analysis models - and hence included in imputation - this may be the case. Therefore, considerable care should be taken when specifying imputation models with other potentially informative variables also being included.   

### Unanswered questions and future research


This analysis only used a single surveillance data-set - in order for the findings to be more easily generalised to other data-sets it should ideally be repeated in additional surveillance data. For this reason this analysis has been structured as an R package (https://doi.org/10.5281/zenodo.3492200). 


**Acknowledgements**

The authors thank the TB section at Public Health England (PHE) for maintaining the Enhanced Tuberculosis Surveillance (ETS) system; all the healthcare workers involved in data collection for the ETS.

**Contributors**

SA conceived and designed the work. SA undertook the analysis with advice from all other authors. All authors contributed to the interpretation of the data. SA wrote the first draft of the paper and all authors contributed to subsequent drafts. All authors approve the work for publication and agree to be accountable for the work.

**Funding** 

SEA, HC, and EBP are funded by the National Institute for Health Research Health Protection Research Unit (NIHR HPRU) in Evaluation of Interventions at University of Bristol in partnership with Public Health England (PHE). The views expressed are those of the author(s) and not necessarily those of the NHS, the NIHR, the Department of Health or Public Health England.

**Conflicts of interest** 

HC reports receiving honoraria from Sanofi Pasteur, and consultancy fees from AstraZeneca, GSK and IMS Health, all paid to her employer.

**Accessibility of programming code**

The code for the analysis contained in this paper can be found at: https://doi.org/10.5281/zenodo.3492200


# References

<div id = 'refs'></div>


# Supplementary Information: Explore and Evaluate the Mechanisms for Missing Data in the Enhanced Tuberculosis Surveillance System

Sam Abbott, Hannah Christensen, Ellen Brooks-Pollock

## Data completeness

```{r plot-missing-struct, fig.cap = prettypublisher::pretty_supfigref("plot-missing-struct", "Summary plot of missing data in the extract of the ETS data used in this thesis. Due to the large size of the dataset, the data has been sub-sampled with only 20\\% of the data shown in this figure. Notifications have been ordered by date of notification from left to right. The following subset of variables are shown: year (year), sex (sex), age (age), PHE Centre (phec), Occupation (occat), Ethnic group (ethgrp), UK birth status (ukborn), Time since entry (timesinceent), date of symptom onset (symptonset), date of diagnosis (datediag), started treatment (startedtreat), date of starting treatment (starttreatdate), treatment end date (txenddate), pulmonary or extra-pulmonary TB (pulmextrapulm), culture (culture), sputum smear status (sputsmear), drug resistance (anyres), previous diagnosis (prevdiag), BCG status(bcgvacc), Year of BCG vaccination (bcgvaccyr), overall outcome (overalloutcome), cause of death (tomdeathrelate), socio-economic status quintiles (natquintile), and date of death (dateofdeath). Nested variables have been accounted for (i.e date of death has had an entry added for cases that are known to have not died)."), out.width = "60%", out.extra = ""}
show_figure("plot-missing-struct")
```


## Drivers of data completeness - additional results tables

### Year of BCG vaccination

```{r bcgvaccyr-miss}
ETSMissing::pull_results(results, "bcgvaccyr") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_suptabref("bcgvaccyr-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for year of BCG vaccination as an outcome, adjusted for: year, sex, age (grouped 
                                as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived 
                                quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all 
                                explanatory variables. The model indicates that year of BCG vaccination is missing at random for the variables considered."))
```

### Date of diagnosis

```{r datediag-miss}
ETSMissing::pull_results(results, "datediag") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_suptabref("datediag-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of diagnosis onset as an 
                                outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status 
                                (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010 onwards were included as socio-economic 
                                status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for all explanatory variables. The model indicates that 
                                date of diagnosis is missing at random for the variables for all variables considered, except for sex."))
```


### Date of starting treatment and ending treatment

```{r starttreatdate-miss}
ETSMissing::pull_results(results, "starttreatdate") %>% 
  knitr::kable(
      caption =  prettypublisher::pretty_suptabref("starttreatdate-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of starting
                               treatment as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth
                               status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications
                               from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios
                               shown are adjusted for all explanatory variables. There is little evidence that the missing data for the date of starting treatment
                               is associated with any variable considered, except for year of notification."))
```


```{r txenddate-miss}
ETSMissing::pull_results(results, "txenddate") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_suptabref("txenddate-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of starting treatment
                                as an outcome, adjusted for: year, sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and
                                socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived quintile. Notifications from 2010
                                onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are
                                adjusted for all explanatory variables. There is little evidence that the missing data for the date of starting treatment is
                                associated with any variable considered, except for year of notification."))
```

### Date of death


```{r dateofdeath-miss}
ETSMissing::pull_results(results, "dateofdeath") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_suptabref("dateofdeath-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for date of death as an outcome, adjusted for: year, sex, age (grouped as 
                                0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates the most deprived 
                                quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios shown are adjusted for 
                                all explanatory variables. The model indicates that there is some evidence that date of death is missing at random for ethnic group, with weaker evidence for all other variables."))
```

### Cause of death


```{r tomdeathrealat-miss}
ETSMissing::pull_results(results, "tomdeathrelat") %>% 
  knitr::kable(
        caption = prettypublisher::pretty_suptabref("tomdeathrealat-miss", "Results from a logistic regression model with data completeness (Complete/Missing) for cause of death as an outcome, adjusted for: year, 
                                sex, age (grouped as 0-14 year olds, 15-65 year olds and 65+), ethnic group, UK birth status and socio-economic status (national quintiles). For socio-economic group 1 indicates 
                                the most deprived quintile. Notifications from 2010 onwards were included as socio-economic status was not collected before this. Complete case analysis was used. Odds ratios 
                                shown are adjusted for all explanatory variables. The model indicates that cause of death is missing at random for ethnic group and UK birth status, with little evidence for any 
                                other variables"))
```


### Assessing temporal biases in reporting

```{r plot-trends-caserepdate, fig.cap = prettypublisher::pretty_supfigref("plot-trends-caserepdate", "a.) Shows the proportion of cases notified in a given month for each year with evidence of a seasonal peak in June. b.) Shows the proportion of cases notified on a given day for each month with a near uniform distribution. Stratifying both figures based on the introduction of the web-based ETS gives little evidence for any change in these trends."), out.width = "60%", out.extra = ""}
show_figure("trends-for-caserepdate")
```

```{r plot-trends-datediag, fig.cap = prettypublisher::pretty_supfigref("plot-trends-datediag", "a.) Shows the proportion of cases with a diagnosis in a given month for each year. b.) Shows the proportion of cases with a diagnosis on a given day for each month. Trends for the date of diagnosis were similar to those seen for notifications."), out.width = "60%", out.extra = ""}
show_figure("trends-for-datediag")
```


```{r plot-trends-dateofdeath, fig.cap = prettypublisher::pretty_supfigref("plot-trends-dateofdeath", "a.) Shows the proportion of cases that died in a given month for each year. b.) Shows the proportion of cases that died on a given day for each month. Trends for the date of death were similar to those seen for notifications but there was a reduction in the strength of the observed seasonality."), out.width = "60%", out.extra = ""}
show_figure("trends-for-dateofdeath")
```



```{r plot-trends-starttreatdate, fig.cap = prettypublisher::pretty_supfigref("plot-trends-starttreatdate", "a.) Shows the proportion of cases starting treatment in a given month for each year. b.) Shows the proportion of cases starting treatment on a given day for each month. Trends for the date of starting treatment were similar to those seen for notifications."), out.width = "60%", out.extra = ""}
show_figure("trends-for-starttreatdate")
```




```{r plot-trends-txenddate, fig.cap = prettypublisher::pretty_supfigref("plot-trends-txenddate", "a.) Shows the proportion of cases ending treatment in a given month for each year with a peak in December. b.) Shows the proportion of cases ending treatment on a given day for each month with some evidence of a bias in reporting on the first of the month. Uncertainty reduced after the introduction of the web-based ETS and the level of bias on the first of the month reduced."), out.width = "60%", out.extra = ""}
show_figure("trends-for-txenddate")
```
